---
import Layout from '../layouts/Layout.astro';
import PomodoroIcon from '../components/icons/PomodoroIcon.astro';
import ButtonTimer from '../components/ButtonTimer.astro';
import ContentButtonsControl from '../components/ContentButtonsControl.astro';
---

<Layout>
    <section class="flex flex-col items-center justify-center gap-y-4 text-center my-8 w-[600px] rounded-[10px] bg-white/10 p-4 shadow-lg z-10">
        <h1 class="flex items-center justify-center gap-x-2 text-lg text-center text-black">
            <span>Mi Pomodoro personal</span>
        </h1>
        
        <!-- Botones Pomodoro, Descanso Corto y Descanso Largo -->
        <div class="flex flex-row items-center gap-x-2 justify-center py-1 px-1 border-2 border-gray-900 rounded-md">
            <ButtonTimer id='pomodoro' name="Pomodoro" />
            <ButtonTimer id='descanso-corto' name="Descanso Corto" />
            <ButtonTimer id='descanso-largo' name="Descanso Largo" />
        </div>

        <!-- Timer comenzando en 25:00 y terminando en 00:00 -->
        <span id="timer" class="text-8xl text-center text-black">25:00</span>

        <!-- Botones para iniciar y parar el timer -->
        <ContentButtonsControl id="pomodoro-buttons-control" />
        <ContentButtonsControl id="s-buttons-control" />
        <ContentButtonsControl id="l-buttons-control" />

        <!-- Texto con la cantidad de pomodoros completados -->
        <span class="flex items-center justify-center gap-x-2 text-lg text-center text-black">
            <!-- Icono de tomate para el pomodoro con color rojo-->
            <PomodoroIcon />
            <span id="pomodoros">Pomodoros completados: <span id="pomodoros-count">0</span></span>
        </span>
    </section>
</Layout>

<script>
    // Recogida de los elementos
    const pomodoro = document.getElementById('pomodoro');
    const descansoCorto = document.getElementById('descanso-corto');
    const descansoLargo = document.getElementById('descanso-largo');

    const timer = document.getElementById('timer');
    const pomodoros = document.getElementById('pomodoros-count');

    const pomodoroButtonsControl = document.getElementById('pomodoro-buttons-control');
    const sButtonsControl = document.getElementById('s-buttons-control');
    const lButtonsControl = document.getElementById('l-buttons-control');

    const audio = new Audio('/assets/media/ma-meilleure-ennemie.mp3');

    // Eventos
    if(pomodoro){
        pomodoro.addEventListener('click', () => {

            audio.play().catch(error => {
                console.error('Error al reproducir:', error);
            });

            // Mostrar los botones de control
            if(pomodoroButtonsControl && sButtonsControl && lButtonsControl){
                pomodoroButtonsControl.style.display = 'flex';
                sButtonsControl.style.display = 'none';
                lButtonsControl.style.display = 'none';
            }

            if(timer && pomodoros){
                // Incrementar el valor del timer
                timer.innerHTML = timer.innerHTML.replace('25:00', '25:01');

                // Incrementar el valor de pomodoros
                pomodoros.innerHTML = `${parseInt(pomodoros.innerHTML) + 1}`;
            }
            
        });
    }

    if(descansoCorto){
        descansoCorto.addEventListener('click', () => {

            if(pomodoroButtonsControl && sButtonsControl && lButtonsControl){
                pomodoroButtonsControl.style.display = 'none';
                sButtonsControl.style.display = 'flex';
                lButtonsControl.style.display = 'none';
            }

            if(timer && pomodoros){
                // Incrementar el valor del timer
                timer.innerHTML = timer.innerHTML.replace('25:00', '25:05');

                // Incrementar el valor de pomodoros
                pomodoros.innerHTML = '0';
            }
        });
    }

    if(descansoLargo){
        descansoLargo.addEventListener('click', () => {

            if(pomodoroButtonsControl && sButtonsControl && lButtonsControl){
                pomodoroButtonsControl.style.display = 'none';
                sButtonsControl.style.display = 'none';
                lButtonsControl.style.display = 'flex';
            }

            if(timer && pomodoros){
                // Incrementar el valor del timer
                timer.innerHTML = timer.innerHTML.replace('25:00', '25:10');

                // Incrementar el valor de pomodoros
                pomodoros.innerHTML = '0';
            }
        });
    }

</script>